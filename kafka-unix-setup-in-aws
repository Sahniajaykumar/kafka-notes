configuring kafka server online in aws on EC2 virtual server
======================================================================

‚úÖ 1. Install Java (OpenJDK 17) // PSA notes

sudo apt update
sudo apt install openjdk-17-jdk -y
java -version

‚úÖ 2. Download and Extract Kafka

cd /opt
sudo wget https://dlcdn.apache.org/kafka/3.9.1/kafka_2.12-3.9.1.tgz
sudo tar -xvzf kafka_2.12-3.9.1.tgz
sudo mv kafka_2.12-3.9.1 kafka

‚úÖ 3. Fix Permissions (Recommended)
Replace ubuntu with your actual username if different:

sudo chown -R ubuntu:ubuntu /opt/kafka

‚úÖ 4. Start Zookeeper
Open Terminal 1:

cd /opt/kafka
bin/zookeeper-server-start.sh config/zookeeper.properties
‚úÖ 5. Start Kafka Server
Open Terminal 2:

cd /opt/kafka
bin/kafka-server-start.sh config/server.properties

‚úÖ 6. Test Kafka
‚û§ Create a Topic
cd /opt/kafka
bin/kafka-topics.sh --create --topic send-email --bootstrap-server localhost:9092 --partitions 1 --replication-factor 1


Update Application.properties file: spring.kafka.bootstrap-servers=ec2-3-109-202-53.ap-south-1.compute.amazonaws.com:9092

‚úÖ 6. Modify server.properties file

sudo vim /opt/kafka/config/server.properties

then add

listeners=PLAINTEXT://0.0.0.0:9092
advertised.listeners=PLAINTEXT://ec2-13-232-203-118.ap-south-1.compute.amazonaws.com:9092


AWS Security Group
Make sure your EC2 instance's security group:

Allows inbound traffic on port 9092 from your client IP or anywhere (0.0.0.0/0 for testing)

Allows inbound traffic on port 2181 if Zookeeper is accessed externally (optional)


==================================================================================================================================================================================

üöÄ Kafka Server Setup on AWS EC2 (Step-by-Step)

üîπ STEP 1: Login to AWS

Go to https://aws.amazon.com

Sign in to AWS Console

üîπ STEP 2: Open EC2

Search EC2

Click EC2 ‚Üí Instances

Click Launch Instance

üîπ STEP 3: Name the Instance

Name: kafka-server (or any name)

üîπ STEP 4: Choose AMI (Operating System)

Select Ubuntu Server 22.04 LTS (Free tier eligible)

üîπ STEP 5: Choose Instance Type

Select t3.medium (4 GB RAM)

Click Next

üîπ STEP 6: Create / Select Key Pair

Click Create new key pair

Name: kafka-key

Type: RSA

Format: .pem

Download and save securely

üîπ STEP 7: Network Settings (Security Group)

Click Edit

Allow inbound rules:
Type	Port	Source
SSH	22	My IP
Custom TCP	9092	My IP
Custom TCP	2181	My IP

‚ö†Ô∏è For testing only you may use 0.0.0.0/0

üîπ STEP 8: Configure Storage

Root volume: 30 GB

Volume type: gp3

üîπ STEP 9: Launch Instance

Click Launch Instance

Wait until Instance State ‚Üí Running

Now connect you local system with EC2 instance  : How ?
==============================================================

Step 1: Connect to your EC2 instance

Make sure you have the .pem key file you downloaded during instance creation (e.g., kafka-key.pem).

Open your terminal (Linux/macOS) or PowerShell/WSL on Windows.

Run these commands:
# Make the key file read-only
chmod 400 kafka-key.pem

# Connect to your EC2 instance (replace <EC2_PUBLIC_IP> with your instance's public IP)
ssh -i kafka-key.pem ubuntu@<EC2_PUBLIC_IP>

Once connected, you should see the Ubuntu shell prompt on your EC2 instance.

Step 2: Update system and install Java 17

Kafka requires Java. Run:
sudo apt update
sudo apt install openjdk-17-jdk -y
java -version

You should see openjdk version "17...". This confirms Java 17 is installed.

Step 3: Download and install Kafka

cd /opt
sudo wget https://dlcdn.apache.org/kafka/3.9.1/kafka_2.12-3.9.1.tgz
sudo tar -xvzf kafka_2.12-3.9.1.tgz
sudo mv kafka_2.12-3.9.1 kafka
sudo chown -R ubuntu:ubuntu /opt/kafka
cd kafka

Step 4: Configure Kafka

1. Open Kafka broker config:
       nano config/server.properties

2. Update these lines:
broker.id=0
listeners=PLAINTEXT://0.0.0.0:9092
advertised.listeners=PLAINTEXT://<EC2_PUBLIC_IP>:9092
log.dirs=/tmp/kafka-logs

3. Save and exit (CTRL + O ‚Üí ENTER ‚Üí CTRL + X)


Step 5: Start Zookeeper

Kafka uses Zookeeper. In Terminal 1:

cd /opt/kafka
bin/zookeeper-server-start.sh config/zookeeper.properties

Keep this terminal open.

Step 6: Start Kafka broker

Open Terminal 2 (new SSH session):

cd /opt/kafka
bin/kafka-server-start.sh config/server.properties


Step 7: Create a Kafka topic

bin/kafka-topics.sh --create --topic send_email --bootstrap-server localhost:9092 --partitions 1 --replication-factor 1

Verify the topic exists: bin/kafka-topics.sh --list --bootstrap-server localhost:9092

Step 8: Update Spring Boot microservice

In your application.properties (producer microservice):

spring.kafka.bootstrap-servers=<EC2_PUBLIC_IP>:9092

Step 9: AWS Security Group check

Make sure your EC2 security group allows:

| Type | Port | Source                        |
| ---- | ---- | ----------------------------- |
| SSH  | 22   | Your IP                       |
| TCP  | 9092 | Your IP (Kafka)               |
| TCP  | 2181 | Your IP (Zookeeper, optional) |

For testing, you can temporarily use 0.0.0.0/0.

‚úÖ After this, your Kafka server is ready on EC2, and your Spring Boot microservice can connect to it for sending/receiving messages.


‚úÖ Tips / Common Issues

Error	                        Fix
Connection refused	          Open port 9092 in Security Group
Timeout	                      Ensure advertised.listeners uses public IP
No Java                       Install OpenJDK 17
Disk full	                    Increase EC2 storage volume

