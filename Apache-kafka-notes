
Apache Kafka
___________

-> It acts as mediator to exchange messages (Message Broker)
-> Kafka is very useful for real time data exchange
-> Publisher will publish the message and subscriber will consume the message

Example of Kafka:

Scenario: 10 Customers Place Orders at Udupi Hotel
Step 1: Customers Place Orders
âœ… Customer App (Producer) â†’ Publishes each order to Kafka (order_topic).
âœ… Udupi Hotel (Consumer) â†’ Subscribes to order_topic and consumes the orders in real-time.

ğŸ”„ Kafka Flow:

10 Customers ---> [Kafka: order_topic] ---> Udupi Hotel App

Step 2: Udupi Hotel Accepts the Orders
âœ… Udupi Hotel (Producer) â†’ Publishes an "Order Accepted" event to order_status_topic.
âœ… Customer App (Consumer) â†’ Subscribes to order_status_topic and receives notifications.

ğŸ”„ Kafka Flow:

Udupi Hotel ---> [Kafka: order_status_topic] ---> 10 Customers
ğŸ”¹ Summary of the Pub/Sub Model
Step	Producer	Kafka Topic	Consumer	Purpose
Customer places order	Customer App	order_topic	Udupi Hotel App	Order received at restaurant
Udupi Hotel accepts order	Udupi Hotel App	order_status_topic	Customer App	Order confirmation notification

ğŸ”¹ When to Store in Database?
âœ”ï¸ YES â€“ When the customer places an order â†’ Store in DB (orders table).
âœ”ï¸ YES â€“ When the order is completed â†’ Update order status in DB.
âŒ NO â€“ For real-time updates (use Kafka instead).


Kafka Architecture:

1. Zookeeper  - This provides environment to run kafka server
2. Kafka Server  - This acts as message broker
3. Kafka Topic - It is used to store and queue messages
4. Publisher - This will push messages to kafkatopic
5. Subscriber - This will fetch the message that is pushed to kafka by publisher


Steps to setup kafka in windows:


Step-1 : Download Zookeeper:

   URL : https://dlcdn.apache.org/zookeeper/zookeeper-3.9.2/apache-zookeeper-3.9.2-bin.tar.gz
   URL : https://dlcdn.apache.org/zookeeper/zookeeper-3.8.4/apache-zookeeper-3.8.4-bin.tar.gz

Step-2 : Download Apache Kafka:

	URL : https://downloads.apache.org/kafka/3.8.0/kafka_2.12-3.8.0.tgz

Step-3 : Set Path of ZOOKEEPER in Environment variables upto bin folder.

Step 4: Copy "zookeeper.properties" and "server.properties" files from "kafka/config" folder to "kafka/bin/windows" folder.

Step-5 : Start Zookeeper server from "kafka/bin/windows" root folder

    Command : zookeeper-server-start.bat zookeeper.properties

Step-6: Start Kafka Server using below command from "kafka/bin/windows" folder

    Command : kafka-server-start.bat server.properties

Note: If kafka server is stopped, delete kafka logs from temp folder and try again to start kafka server

Step-7 : Create Kakfa Topic from "kafka/bin/windows" root folder

Command : kafka-topics.bat --create --bootstrap-server localhost:9092 --replication-factor 1 --partitions 1 --topic order_topic_1

Step-8 : View created Topics using below command

   Command : kafka-topics.bat --list --bootstrap-server localhost:9092


Kafka Bootstrap Server URL : http://localhost:9092/ or http://192.30.43.2:9092/ for linux server created in cloud

=========================================================================================================================================

Q: Why should we use kafka ?

âœ… 1. Decoupling Microservices (Loose Coupling)

Without Kafka:

Service A sends data directly to Service B

If B is down â†’ A fails

System becomes fragile

With Kafka:

A sends message to Kafka

B reads it whenever itâ€™s available

Even if B is down, messages are safe

ğŸ‘‰ Microservices no longer depend on each other.

âœ… 2. High Performance (Real-Time Messaging)

Kafka handles millions of messages per second.

Perfect for:

Logs

Notifications

Payment events

Order processing

Tracking user activity

âœ… 3. Fault Tolerance (No Data Loss)

Kafka stores messages on disk and replicates them.
Even if a server crashes â†’ data is not lost.

âœ… 4. Scalability

Need more capacity?

Just add more Kafka brokers (servers).
Kafka scales horizontally and automatically.

âœ… 5. Asynchronous Communication

Services donâ€™t have to wait for each other.

Example:
User registers â†’ Auth service publishes message â†’
Email service reads it later â†’ SMS service reads it later.

Faster response time for the user.

âœ… 6. Multiple Consumers for Same Data

One message â†’ Many services can read it.

Example:
Order Created Event

Billing Service reads

Notification Service reads

Inventory Service reads

Analytics Service reads

Kafka supports fan-out messaging.

===================================================================================================================================
ğŸ›ï¸ Kafka Architecture (Complete Overview)

Kafka is a distributed event streaming platform made up of the following core components:

ğŸ”· 1. Producers

Applications that publish messages (events) into Kafka topics.

Example:

Auth Service â†’ sends "Send Email" event

Order Service â†’ sends "Order Created" event

ğŸ”· 2. Consumers

Applications that read/consume messages from topics.

Example:

Notification Service â†’ reads "Send Email"

Inventory Service â†’ reads "Order Created"

Consumers can be grouped into Consumer Groups for load balancing.

ğŸ”· 3. Topics

A category or stream to which messages are published.

Example:

send_email

order_events

payment_events

ğŸ”· 4. Partitions

Each topic is divided into multiple partitions.

Example:

order_events:
    Partition-0
    Partition-1
    Partition-2


Benefits:

Parallel processing

Scalability

High throughput

ğŸ”· 5. Brokers (Kafka Servers)

A Kafka broker is a server that stores data and handles requests.

A Kafka cluster = multiple brokers.

Example:

Broker 1
Broker 2
Broker 3


Messages are distributed across brokers.

ğŸ”· 6. Zookeeper / KRaft

Kafka needs:

Zookeeper (older versions)

KRaft mode (new versions, no Zookeeper)

Used for:

Cluster coordination

Leader election

Metadata management

ğŸ”· 7. Leader & Replicas

Each partition has:

Leader â†’ handles read/write

Replicas â†’ backup for fault-tolerance

If leader fails â†’ replica becomes new leader.

ğŸ”· 8. Offsets

Each message has a unique ID inside a partition.

Example:

Offset 0 â†’ Order created  
Offset 1 â†’ Payment initiated  
Offset 2 â†’ Email sent


Consumers track offsets.

ğŸ“˜ Kafka Architecture Diagram (Text Version)
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚         PRODUCERS           â”‚
                â”‚ (Auth Service, Order App)   â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚        TOPIC          â”‚
                   â”‚     send_email        â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                    â–¼                    â–¼
  Partition-0          Partition-1          Partition-2
   Leader B1            Leader B2            Leader B3
   Replica B2           Replica B3           Replica B1
   Replica B3           Replica B1           Replica B2

         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                    â–¼                    â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  BROKER 1   â”‚     â”‚  BROKER 2   â”‚      â”‚  BROKER 3   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚                     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                        â–¼                   â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  CONSUMERS    â”‚   â”‚ Consumer Group â”‚
                 â”‚ Email Service â”‚   â”‚   Notification â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ”¥ How Kafka Works (Flow)

Producer sends message â†’ Topic

Topic stores message â†’ Partition

Partition replicates message across brokers

Consumer reads message from partition

Consumer commits the offset

Kafka ensures:

No data loss

High performance

Scalability
